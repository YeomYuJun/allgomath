global:
  resolve_timeout: 5m
  # Slack webhook URL (ì‹¤ì œ ì‚¬ìš© ì‹œ ì„¤ì • í•„ìš”)
  # slack_api_url: 'https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK'

# ì•Œë¦¼ ë¼ìš°íŒ… ê·œì¹™
route:
  group_by: ['alertname', 'component']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 12h
  receiver: 'default'

  routes:
    # Critical ì•Œë¦¼ì€ ì¦‰ì‹œ ì „ì†¡
    - match:
        severity: critical
      receiver: 'critical-alerts'
      group_wait: 0s
      repeat_interval: 5m

    # Warning ì•Œë¦¼ì€ ê·¸ë£¹í™”
    - match:
        severity: warning
      receiver: 'warning-alerts'
      group_wait: 30s
      repeat_interval: 1h

    # Redis ê´€ë ¨ ì•Œë¦¼
    - match:
        component: redis
      receiver: 'redis-alerts'
      group_wait: 20s

    # API ê´€ë ¨ ì•Œë¦¼
    - match:
        component: api
      receiver: 'api-alerts'
      group_wait: 20s

# ì•Œë¦¼ ìˆ˜ì‹ ì ì„¤ì •
receivers:
  # ê¸°ë³¸ ìˆ˜ì‹ ì (ë¡œê·¸ë§Œ ì¶œë ¥)
  - name: 'default'
    webhook_configs:
      - url: 'http://localhost:9093/api/v1/alerts'
        send_resolved: true

  # Critical ì•Œë¦¼ (Slack + Email)
  - name: 'critical-alerts'
    # Slack ì„¤ì • (ì‹¤ì œ ì‚¬ìš© ì‹œ ì£¼ì„ í•´ì œ)
    # slack_configs:
    #   - channel: '#allgomath-critical'
    #     title: 'ğŸš¨ Critical Alert: {{ .GroupLabels.alertname }}'
    #     text: '{{ range .Alerts }}{{ .Annotations.description }}{{ end }}'
    #     send_resolved: true

    # Email ì„¤ì • (ì‹¤ì œ ì‚¬ìš© ì‹œ ì£¼ì„ í•´ì œ)
    # email_configs:
    #   - to: 'admin@allgomath.com'
    #     from: 'alertmanager@allgomath.com'
    #     smarthost: 'smtp.gmail.com:587'
    #     auth_username: 'alertmanager@allgomath.com'
    #     auth_password: 'YOUR_PASSWORD'
    #     headers:
    #       Subject: '[CRITICAL] AllgoMath Alert'

    # Webhook (ì„ì‹œ - ë¡œê·¸ìš©)
    webhook_configs:
      - url: 'http://localhost:9093/api/v1/alerts'
        send_resolved: true

  # Warning ì•Œë¦¼
  - name: 'warning-alerts'
    # slack_configs:
    #   - channel: '#allgomath-warnings'
    #     title: 'âš ï¸ Warning: {{ .GroupLabels.alertname }}'
    #     text: '{{ range .Alerts }}{{ .Annotations.description }}{{ end }}'
    #     send_resolved: true

    webhook_configs:
      - url: 'http://localhost:9093/api/v1/alerts'
        send_resolved: true

  # Redis ì•Œë¦¼
  - name: 'redis-alerts'
    # slack_configs:
    #   - channel: '#allgomath-redis'
    #     title: 'ğŸ’¾ Redis Alert: {{ .GroupLabels.alertname }}'
    #     text: '{{ range .Alerts }}{{ .Annotations.description }}{{ end }}'

    webhook_configs:
      - url: 'http://localhost:9093/api/v1/alerts'
        send_resolved: true

  # API ì•Œë¦¼
  - name: 'api-alerts'
    # slack_configs:
    #   - channel: '#allgomath-api'
    #     title: 'ğŸŒ API Alert: {{ .GroupLabels.alertname }}'
    #     text: '{{ range .Alerts }}{{ .Annotations.description }}{{ end }}'

    webhook_configs:
      - url: 'http://localhost:9093/api/v1/alerts'
        send_resolved: true

# ì•Œë¦¼ ì–µì œ ê·œì¹™ (ì¤‘ë³µ ì•Œë¦¼ ë°©ì§€)
inhibit_rules:
  # Critical ì•Œë¦¼ì´ ë°œìƒí•˜ë©´ ê°™ì€ ì»´í¬ë„ŒíŠ¸ì˜ Warning ì–µì œ
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['component', 'alertname']

  # API ë‹¤ìš´ ì‹œ ë‹¤ë¥¸ API ê´€ë ¨ ì•Œë¦¼ ì–µì œ
  - source_match:
      alertname: 'AllgoMathAPIDown'
    target_match_re:
      alertname: '(HighAPILatency|HighErrorRate|LowThroughput)'
    equal: ['component']

  # Redis ë‹¤ìš´ ì‹œ ë‹¤ë¥¸ Redis ê´€ë ¨ ì•Œë¦¼ ì–µì œ
  - source_match:
      alertname: 'RedisDown'
    target_match_re:
      alertname: '(LowCacheHitRate|HighRedisMemoryUsage|HighRedisConnections)'
    equal: ['component']
